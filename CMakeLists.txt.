#
# WARNING: this is only provided for those who absolutely do not have access
# to Qbs. this build script is intentionally barebones and does not have
# all the utilities of the Qbs one, in particular, full installation.
#

cmake_minimum_required(VERSION 3.5)

project(Tok LANGUAGES CXX)

set(CMAKE_INCLUDE_CURRENT_DIR ON)

set(CMAKE_AUTOUIC OFF)
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(GNUInstallDirs)

set(REQUIRED_QT_VERSION 5.15.0)

find_package(PkgConfig)

find_package(Qt5 COMPONENTS Core Quick QuickTest Widgets Concurrent Multimedia REQUIRED)
find_package(KF5Kirigami2 REQUIRED)
find_package(KF5I18n REQUIRED)
find_package(KF5Notifications REQUIRED)
find_package(KF5ConfigWidgets REQUIRED)
find_package(KF5WindowSystem REQUIRED)
find_package(KF5SyntaxHighlighting REQUIRED)
find_package(Td REQUIRED)
pkg_check_modules(RLottie REQUIRED IMPORTED_TARGET rlottie)
pkg_check_modules(ZLib REQUIRED IMPORTED_TARGET zlib)

find_package(ICU 61.0 COMPONENTS uc i18n REQUIRED)

file(GLOB files
  "./src/*.cpp"
  "./src/*.h"
  "./src/internallib/*.cpp"
  "./src/internallib/*.h"
  "./src/yoinked from qt automotive/*.cpp"
  "./src/yoinked from qt automotive/*.h"
)
list(REMOVE_ITEM files
  ${CMAKE_SOURCE_DIR}/./src/test_main.cpp
)

add_library(rlottiePlugin
  STATIC

  "./src/the rlottie plugin/rlottie.json"
  "./src/the rlottie plugin/rlottieimage.cpp"
  "./src/the rlottie plugin/rlottieimage.h"
  "./src/the rlottie plugin/rlottieplugin.cpp"
  "./src/the rlottie plugin/rlottieplugin.h"
)

add_executable(org.kde.Tok
  ${files}

  data/main.qrc
)

target_link_libraries(rlottiePlugin
  PUBLIC
    Qt5::Core Qt5::Gui
    PkgConfig::RLottie PkgConfig::ZLib
)
target_compile_definitions(rlottiePlugin
  PRIVATE
    -DQT_STATICPLUGIN
)

target_link_libraries(org.kde.Tok
  PUBLIC
    Qt5::Core Qt5::CorePrivate Qt5::Widgets Qt5::Quick Qt5::QuickPrivate Qt5::Concurrent Qt5::Multimedia
    KF5::Kirigami2 KF5::I18n KF5::Notifications KF5::ConfigWidgets KF5::WindowSystem KF5::SyntaxHighlighting
    Td::TdStatic ICU::uc ICU::i18n
    rlottiePlugin
)

target_include_directories(org.kde.Tok
  PUBLIC
    "./src/internallib"
    "./src/yoinked from qt automotive"
)

install(TARGETS org.kde.Tok DESTINATION ${CMAKE_INSTALL_BINDIR})
